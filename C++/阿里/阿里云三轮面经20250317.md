# 阿里云三轮面经20250317

### 一面：（30分钟）

撕代码，反转链表

## 设计支持很多数据库的同步备份系统（开放性问题，阅读源码、学习别人的设计思路很重要）



| 数据源适配器 | -->  | 消息队列 (Kafka/MQ) | -->  | 数据处理引擎 | -->  | 数据目标适配器 | -->  | 备份目标 (HDFS/云存储/备库) |
| ------------ | ---- | ------------------- | ---- | ------------ | ---- | -------------- | ---- | --------------------------- |
|              |      |                     |      |              |      |                |      |                             |
| (Data Source Adapter) |      | (Message Queue) |      | (Data Processing Engine) |      | (Data Destination Adapter) |      | (Backup Destination) |
| --------------------- | ---- | --------------- | ---- | ------------------------ | ---- | -------------------------- | ---- | -------------------- |
|                       |      |                 |      |                          |      |                            |      |                      |
| (MySQL, PG, MongoDB, Redis...) |      |      |      |      |      | (HDFS, Cloud Storage, DB Cluster...) |      |      |
| ------------------------------ | ---- | ---- | ---- | ---- | ---- | ------------------------------------ | ---- | ---- |
|                                |      |      |      |      |      |                                      |      |      |
​                                        ^
​                                        |
​                                        +-------------------+
​                                        |   控制中心        |
​                                        | (Control Center)  |
​                                        +-------------------+

**关键模块详细设计：**

接下来，我想重点展开讨论 **数据源适配器** 中的 **数据捕获 (CDC)** 部分，以及 **数据一致性** 的处理。

**1. 数据捕获 (CDC) 策略：**

对于不同的数据库，我们需要采用不同的 CDC 策略：

- **关系型数据库 (MySQL, PostgreSQL):**  关系型数据库通常都提供 **Binlog** 或者 **WAL (Write-Ahead Logging)** 机制，记录数据库的所有事务操作。  我们可以通过解析 Binlog/WAL 来捕获数据变更。

  - **优点：** 性能高，对源数据库侵入性小，可以捕获所有的数据变更（包括 INSERT, UPDATE, DELETE）。
  - **缺点：** 需要解析数据库的日志格式，不同数据库版本之间日志格式可能存在差异，解析逻辑相对复杂。 需要考虑日志的持久化和消费进度管理。
  - **工具选择：** 可以考虑使用成熟的 CDC 工具，例如 **Debezium**, **Maxwell's Daemon** 等，这些工具已经封装了 Binlog/WAL 解析的复杂性，并提供了统一的接口。

- **NoSQL 数据库 (MongoDB, Redis):**  NoSQL 数据库的 CDC 机制相对来说没有关系型数据库那么成熟，但也有一些方法可以实现数据捕获：

  - **MongoDB：** MongoDB 提供了 **Oplog (Operation Log)** 机制，类似于关系型数据库的 Binlog。 我们可以通过读取 Oplog 来捕获数据变更。 MongoDB 的 Change Streams 功能也提供了更方便的 CDC 接口。

  - **Redis：** Redis 提供了 **Replication Stream** 功能，可以获取 Redis 的操作命令流。 我们可以解析命令流来捕获数据变更。 Redis 4.0 之后引入的 **PSYNC** 命令也支持增量同步。 对于持久化的 Redis，也可以考虑解析 **AOF (Append Only File)** 日志。

  - 轮询 (Polling) 机制：

    对于一些不支持日志机制的 NoSQL 数据库，或者对于实时性要求不高的场景，可以采用轮询机制，定期扫描源数据库的数据，对比上次扫描的结果，找出数据变更。

    - **优点：** 实现简单，通用性强，适用于各种数据库。
    - **缺点：** 实时性差，性能开销大，可能会遗漏数据变更。 通常不建议作为主要的 CDC 策略，可以作为补充手段。

**2. 数据一致性处理：**

- **最终一致性保证：** 在正常情况下，通过消息队列的可靠传输和数据处理引擎的幂等性处理，我们可以保证数据最终能够同步到备份目标，达到最终一致性。

- 异常情况处理：

  当发生网络分区、数据库故障等异常情况时，可能会出现数据同步延迟或者数据丢失的情况。 我们需要考虑以下措施：

  - **监控告警：** 实时监控数据同步的延迟和错误率，及时发现异常情况并告警。
  - **重试机制：** 对于数据同步失败的情况，例如消息发送失败、数据写入失败，需要实现重试机制，保证数据最终能够成功同步。
  - **数据校验和修复：** 可以定期进行数据校验，对比源数据库和备份目标的数据，找出不一致的地方，并进行数据修复。 例如，可以基于时间戳或者版本号进行数据对比。
  - **全量同步和增量同步结合：** 在系统启动初期，或者在发生严重的数据不一致时，可以进行一次全量同步，将源数据库的所有数据同步到备份目标。 之后再切换到增量同步模式，只同步数据变更。

**技术选型：**

- **消息队列：** **Kafka** 或者 **RabbitMQ** 都是不错的选择。 **Kafka** 具有更高的吞吐量和更好的可扩展性，适合处理大规模的数据同步场景。 **RabbitMQ** 更轻量级，易于部署和管理，适合中小型应用场景。 可以根据实际的规模和需求进行选择。
- **数据存储：** **HDFS** 或者 **云存储服务 (例如 AWS S3, Azure Blob Storage, Google Cloud Storage)** 适合作为备份数据的存储目标，具有低成本、高可靠性、高可扩展性的特点。 如果需要支持读写分离和快速切换，也可以考虑使用 **备用的同类型数据库集群**。
- **CDC 工具：** **Debezium**, **Maxwell's Daemon** 等开源 CDC 工具可以大大简化关系型数据库 CDC 的开发工作。 对于 NoSQL 数据库，可能需要根据具体的数据库类型选择合适的 SDK 或者客户端库。
- **监控告警：** 可以使用 **Prometheus** + **Grafana** 构建监控系统，使用 **Alertmanager** 进行告警管理。





### 二面：（60分钟）

muduo网络库
自己的项目介绍

## slect、epoll区别



## 网络编程流程

1. **确定网络协议和通信模式:** 在开始任何网络编程之前，我们需要明确应用场景的需求，并据此选择合适的网络协议和通信模式。
2. **创建 Socket (套接字):** Socket 是网络编程的基石，它是应用程序访问网络资源的接口。我们需要根据选择的协议和通信模式创建相应的 Socket。
3. **绑定地址和端口 (服务器端):** 对于服务器端程序，需要将创建的 Socket 绑定到一个特定的 IP 地址和端口号上，这样客户端才能找到并连接到服务器。
4. **监听连接 (服务器端):** 服务器端 Socket 需要进入监听状态，等待客户端的连接请求。
5. **建立连接 (客户端和服务器端):** 客户端发起连接请求，服务器端接受连接请求，从而在客户端和服务器端之间建立起一个网络连接。
6. **数据传输:** 连接建立后，客户端和服务器端可以通过 Socket 进行数据的发送和接收。
7. **关闭连接:** 当数据传输完成后，或者通信不再需要时，需要主动关闭连接，释放网络资源。
8. **错误处理:** 在网络编程的各个阶段，都可能出现各种错误，例如连接失败、数据发送失败、连接中断等。 良好的错误处理机制是保证程序健壮性的关键。



## https和连接建立过程

1. **客户端发起 Client Hello (客户端问候)**
2. **服务器返回 Server Hello (服务器问候)**
3. **服务器发送 Certificate (证书)**
4. **客户端验证 Certificate (证书验证)**
5. **密钥交换 (Key Exchange)**
6. **加密通信 (Encrypted Communication)**



B+树

TOPk的问题

## hash冲突解决



## 虚函数定义

虚函数是一个在 **基类 (Base Class)** 中声明的函数，并且被声明为 `virtual`。  它的关键特性在于，当通过 **基类的指针或引用** 调用这个函数时，实际执行的是 **派生类 (Derived Class)** 中 **重写 (Override)** 后的版本，即使指针或引用指向的是基类类型。



实验室的项目（问了好久，大约20多分钟）

### 三面：（30分钟）

实验室的项目
自己的项目介绍
看过那些源码

原子行操作

底层实现

高并发访问网站设计

大量已排序数据进行合并说明优化思路

set和map底层数据结构实现，为啥用红黑树

### HR面（20分钟）

谈人生谈理想
总结：像阿里这样的大公司，会问比较多的开放性的问题，基础知识 反而 问的比较少，多阅读源码会是一个很大的加分项！