# 阿里三轮面经困难20250319

### 一面：

（面了1小时30分钟的样子。。）

自我介绍
之后就是狂怼项目。。。。怼了一个小时，涉及到的东西比较广吧，大概回想到如下：

UDP可靠传输

数据库底层原理（讲MySQL数据库引擎、三范式、数据库设计）

## NoSQL（优缺点，对于一些特殊的应用场景比如微博好友你怎么设计，选用什么数据库比较合适）

+ 需求：
  + 高并发读写
  + 关系型数据为主
  + 数据量庞大
  + 负载的关系：共同好友
+ 数据模型设计
  + 用户表 / 双向关系表
  + **图数据库模型:** 将用户作为节点 (Node)，好友关系作为边 (Edge)
+ 数据库选型
  + 关系数据库：成熟稳定，事务支持性强。复杂关系查询Join开销大。
  + 图数据库：专门为处理关系型数据而设计，擅长高效地进行关系查询和图遍历。 对于微博好友系统这种关系密集型的应用，图数据库在性能上会有优势，尤其是在处理复杂社交关系查询时。 水平扩展能力也相对较好。
+ **缓存策略:** 无论选择哪种数据库，都应该结合缓存 (例如 Redis, Memcached) 来提高热点数据的访问速度。 可以缓存用户的常用好友列表，以及热门的社交关系查询结果。
+ **数据分片与分区:** 当数据量非常庞大时，需要考虑对数据库进行分片或分区，将数据分散到多台服务器上，提高系统的整体吞吐量和存储能力。
+ **读写分离:** 对于读多写少的场景，可以采用读写分离架构，将读请求和写请求分发到不同的数据库实例上，提升系统的并发处理能力。
+ **索引优化:** 针对不同的查询场景，需要合理地创建索引，优化查询性能。 在图数据库中，通常会对节点和边的属性建立索引，加速图遍历。



你认为C++与C的区别在哪？



C++多态实现原理（就从C++对象模型开始讲，把虚函数虚表指针之类的都讲了）



为什么析构函数要写成虚函数以及为什么不要在构造/析构函数调用虚函数（这里扩展多一点，举了很多例子然后从Effective C++里面提到的去讲，哪些情况必须要把析构函数写成虚函数）



怼项目细节，怼的特别细。。怼到让我怀疑这个项目不是我做的。。本人有一个仿造Nginx的轮子，所以对于master/worker进程架构、epoll的细节问的特别多



**考虑过多线程吗？怎么进一步提高epoll的效率，这里跟面试官指点我可以把epoll_wait得到的描述符用多线程处理，然后处理完再放回红黑树去。**



就是然后发了个链接手撕代码，让我写是STL中unique函数的实现，写了10多20分钟的样子写好了

最后10分钟就是聊天，聊业务啊、进去后能干什么啊，面试官对我的评价啊（后来二面面试官告诉我一面面试官是我老乡，我就说为啥聊的这么high ? ?）

### 二面：

（一面当晚7点收到面试官电话，约明天下午二面，面了50分钟的样子）

没啥好说的，就是写代码！talk is cheap, show me the code!（屁话少说，放码过来，知乎这个神翻译真的是哈哈哈哈）
先聊了聊基础知识，比如对于进程空间的理解，然后给自己挖坑。。

## 题目1：刚才说了进程空间，怎么求一个进程可用栈空间的大小？

`ulimit -s`

`cat /proc/$(pidof your_process)/limits | grep "stack size"`



```c++
#include <sys/resource.h>
#include <iostream>

int main() {
    struct rlimit rlim;
    if (getrlimit(RLIMIT_STACK, &rlim) == 0) {
        std::cout << "Stack size limit (soft): " << rlim.rlim_cur << " bytes" << std::endl;
        std::cout << "Stack size limit (hard): " << rlim.rlim_max << " bytes" << std::endl;
    } else {
        perror("getrlimit");
    }
    return 0;
}
```





题目2：序列化数组，比如[1,100,1000…]，让你把一个数组存到文件，尽可能节省空间，并且要能快速的序列化、反序列把数组读出来（反正我是没做出来。。被怼死了一度以为凉了 ? ?说了哈夫曼编码面试官不满意，说要边扫描数组边序列化提高效率，然后就是瞎扯了。。因为要节省空间，所以只能从编码的角度去思考，最后还是没写出来，只是不断在跟面试官交流思路。。）

- **变长编码 (Variable-length Encoding):**  对于较小的数值，使用较少的字节表示；对于较大的数值，使用较多的字节表示。  这样可以有效节省空间，特别是当数组中包含大量小数值时。 常用的变长编码方式有：
  - **Varint (Variable Integer):** Protocol Buffers 和 gRPC 等广泛使用的变长编码，每个字节的最高位作为标志位，指示是否还有后续字节。
  - **LEB128 (Little-Endian Base 128):** WebAssembly 等使用的变长编码，原理类似 Varint。
- **差值编码 (Delta Encoding):**  存储当前数值与前一个数值的差值，而不是直接存储数值本身。  如果数组中的数值是递增或变化幅度较小的，差值通常会比原始数值小得多，从而进一步降低数值的大小，提高变长编码的效率。  对于示例 `[1, 100, 1000...]`，差值序列为 `[1, 99, 900...]`，虽然数值仍然较大，但如果数组是更平滑的递增，效果会更明显。



### 三面：

（周一收到HR联系，说安排三面，准备交叉面，面了40分钟的样子）
一上来就直接问我熟不熟悉数据库，说了还行，结果走上了不归路。。

MySQL数据库引擎说一下



## 表过大会有什么影响、怎么解决（我说了水平分表和垂直分表）

- **数据拆分（Sharding）：**  这是解决大表问题的核心思路，也是最有效的方法之一。  数据拆分可以将一个大表的数据分散到多个更小的表或者数据库中，从而降低单表的数据量，提高查询和写入性能，并降低维护成本。  数据拆分主要有两种方式：
  - **水平拆分（Horizontal Sharding）：** 也称为分表。 将一个表的数据按照某种规则（例如用户ID的Hash值、时间范围等）分散到多个结构相同的表中。 每个分表只包含一部分数据，从而降低单表数据量。 水平拆分的优点是可以显著提高查询和写入性能，缺点是会**增加查询的复杂度**，可能需要跨多个分表进行查询，并且分片规则的选择和维护也比较重要。
  - **垂直拆分（Vertical Sharding）：** 也称为分库。 将一个表的不同列拆分到不同的表中，甚至不同的数据库中。 通常是按照业务模块或者访问频率来拆分。 例如，将用户表中的常用字段（例如用户名、邮箱）放在一个表中，不常用的大字段（例如用户详细信息、用户头像）放在另一个表中。 垂直拆分的优点是可以减少单表的宽度，提高查询效率，并且可以根据业务模块进行优化和扩展。 缺点是可能会**导致join操作的增加**，需要权衡利弊。
- **优化现有表结构和查询：**  在进行数据拆分之前，或者作为数据拆分的补充，可以先对现有的表结构和查询进行优化，尽可能地提高现有表的性能。
  - **索引优化：** 检查并优化表的索引设计，确保索引覆盖常用的查询条件，避免索引失效，并定期分析和优化索引，例如删除冗余索引、重建索引等。
  - **查询优化：** 分析慢查询日志，优化SQL语句，避免全表扫描，尽量使用索引，优化join操作，减少不必要的数据读取，可以使用 `EXPLAIN` 分析SQL的执行计划，找出性能瓶颈。
  - **数据类型优化：** 选择更合适的数据类型，例如使用 `INT` 而不是 `BIGINT`，使用 `VARCHAR` 而不是 `TEXT` 等，可以减少存储空间，提高查询效率。
  - **反范式设计：** 在某些场景下，可以适当进行反范式设计，例如增加冗余字段，减少join操作，提高查询效率。 但需要权衡数据冗余和数据一致性的问题。
- **使用缓存：**  引入缓存机制，例如使用Redis、Memcached等缓存常用的热点数据，可以有效减少数据库的访问压力，提高查询响应速度。  缓存可以放在不同的层级，例如应用层缓存、数据库查询缓存等。  需要注意缓存的更新策略和数据一致性问题。



刚才你说了分表，能详细说下嘛（主要解释了水平分表，说了哈希）



你刚才的水平分表固定哈希，如果想要加表、删表怎么办（果然来了！得亏知道一致性哈希算法，不然就交代在这了。。就说了下刚才的哈希算法数据迁移很不方便，然后讲了下一致性哈希算法、优点）



## 行成哈希环后单点故障怎么解决（我就说了心跳包机制）

- **数据冗余与副本机制 (Replication):**  这是应对单个物理节点故障的最核心和最通用的方法。  **对于存储在哈希环节点上的数据，我们不能只保存一份，而是需要引入副本机制。**  常见的做法是为每个数据对象维护多个副本，并将这些副本存储在哈希环上不同的节点上。  这样，当某个节点发生故障时，我们可以从其他副本节点读取数据，保证数据的可用性。  副本策略可以有多种选择，例如：
  - **多副本存储：** 例如为每个数据对象存储 2 份或 3 份副本。 副本数量越多，容错性越高，但存储成本也越高。
  - **副本分布策略：** 副本应该尽量分布在不同的物理节点甚至不同的机架、机房，以提高容灾能力，避免单点故障扩散。 一致性哈希本身可以帮助我们实现副本的自动分布，例如，可以将一个数据对象哈希到环上的多个节点，并将这些节点作为副本节点。
  - **一致性协议：** 在多副本场景下，需要考虑数据一致性问题。 常用的协议包括强一致性协议（例如 Paxos、Raft）和最终一致性协议（例如 Gossip 协议）。 根据业务对数据一致性的要求选择合适的协议。
- **虚拟节点和负载均衡:**  虽然虚拟节点的主要目的是为了更好的负载均衡，但它也能间接地提高系统的容错性，降低 “代表性” 单点故障的风险。  通过增加虚拟节点的数量，并将它们更均匀地分布在哈希环上，可以使得每个物理节点负责的哈希环范围更小更分散。  这样，即使某个物理节点故障，受影响的数据和请求也会更加分散，降低单个节点故障带来的整体影响。  同时，负载均衡策略也需要考虑故障节点的剔除和流量重新分配。
- **监控与自动故障转移 (Monitoring and Failover):**  **完善的监控系统是及时发现和处理单点故障的关键。**  我们需要对哈希环中的每个节点进行实时的健康检查，监控节点的 CPU、内存、磁盘、网络等指标，以及节点的服务状态。  一旦发现节点故障，需要能够及时发出告警，并触发自动故障转移流程。  自动故障转移流程可能包括：
  - **节点隔离：** 将故障节点从哈希环中暂时移除，不再将新的请求路由到该节点。
  - **数据迁移与恢复：** 对于存储在故障节点上的数据，需要从副本节点进行数据恢复，并迁移到其他健康节点上，以保证数据的完整性和可用性。 一致性哈希的特性可以帮助我们高效地进行数据迁移，只需要迁移受影响的数据范围。
  - **请求重路由：** 将原本应该路由到故障节点的请求，重新路由到其他健康的节点或者副本节点上。
- **去中心化架构 (Decentralized Architecture):**  为了避免中心化控制中心带来的单点故障风险，可以考虑采用去中心化的架构。  例如，可以使用分布式一致性协议（例如 Raft、Gossip）来维护哈希环的元数据信息，而不是依赖于一个中心化的组件。  每个节点都维护一份完整的哈希环信息，节点之间的信息同步通过分布式协议来完成。  这样，即使部分节点故障，整个哈希环仍然可以正常运行。
- **服务降级与熔断 (Service Degradation and Circuit Breaker):**  在极端情况下，即使采取了各种容错措施，仍然可能出现服务不可用的情况。  这时，需要考虑服务降级和熔断机制。  例如，可以预先定义一些备用方案，当主服务不可用时，可以切换到备用方案，保证基本的服务可用性。  熔断机制可以防止故障扩散，避免雪崩效应。



怎么保证数据一致性（我都不知道为啥问了我这么多分布式系统的东西。。明明简历没写啊 ? ?面试时没了解这么深，只讲了重传数据库Log，后面了解到分布式一致性的拜占庭将军问题及其解决算法——Raft以及ZooKeeper的解决方案，反正分布式系统可以去看看，就CAP三个原则）



## UDP可靠传输



select、poll、epoll讲一下



怼项目相关（怼项目的时候又扩展到了很多软件工程相关的知识，比如软件测试、软件工程导论，得亏学过，不然又凉了。。）



你对项目进行压力测试的目的是什么？主要关注哪些东西？如果要你来写一个检测系统检测阿里的业务，你会怎么写？（这里就一顿扯。。扯到了自己对于软件开发过程的理解，需求-开发-测试424原则，敏捷开发、迭***发，还有白盒测试、黑盒测试、压力测试、系统负载测试、容量测试之类的，反正就是软件工程导论+软件测试。这里因为软件工程导论学了快两年了，有点忘了，直接跟面试官说了不是特别懂， 千万不要不懂装懂！！）
看过什么源码吗？（看过Nginx的）



讲下Nginx（因为自己有个Nginx的轮子，所以就讲了下Nginx的架构、模块关系、以及accept_mutex的实现，面试官不满意。。。问我Nginx的信号是怎么传递的，直接说了不懂）

接下来就是聊人生了
你对于总监的看法是什么？你觉得总监平时的工作内容？总监的代码开发与其他工作的占比？（因为我的职业规划写了总监，结果被问了…感觉三面面试官就是总监吧，因为都在阿里工作10年了。所以就跟我聊了总监这事）
那根据你刚才的描述，你觉得总监符合你的期望吗？（当然符合啊，不然岂不是给自己挖坑！！然后说了一堆软件工程的东西，总算圆好了这个问题）
你觉得你的优点是什么？
有什么想问我的吗？

总的来说，三面广度比较大、也有一定的深度，好多次差点把自己坑死了。。。后面赶紧去恶补了下分布式系统和大数据的知识，怕交叉面被怼死。。总体感觉还算可以，后面确实也过了，隔了一天HR联系我了说给我安排交叉面。

### HR面：

（不知道为什么没有交叉面，直接HR面了，一点准备都没有。。因为之前说是交叉面的，所以一直在准备技术，面了20分钟）
就是很常规的HR面，没什么特别坑的地方

自我介绍
业余爱好
性格缺点
用三个词形容下自己
目前有offer了吗？还在面其他公司吗？（好了，送命题！且答且珍惜）
你有什么偶像吗？（想了想说了马云先生是我的偶像。。）
工作地？（这个问题好像我每轮面试的面试官都问了…因为我不是特别想去杭州，所以感觉部门比较在意这个，当时HR面完当天晚上二面面试官还联系我去不去杭州，最后发下来录取意向书竟然不是杭州，开心…）
有什么想问我的吗？（就问了下培养制度以及各地的业务，最后感觉前面有没有Offer的问题没有答好，所以就最后表了下如果收到Offer一定会去阿里的决心，好像有用？）

差不多就这么多，毕竟啥准备没有就被HR面了…才面了20分钟，差点都以为凉了 ? ?得亏当天晚上出去浪坐地铁的时候我二面面试官联系我了，问我能不能去杭州（感觉是问base），才觉得稳一点了，不然那叫一个慌啊??